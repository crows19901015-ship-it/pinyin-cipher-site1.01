<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>拼音9键暗码工具 - 改进版</title>
<style>
body {
  font-family: "Segoe UI", sans-serif;
  background: #0e0e0e;
  color: #f1f1f1;
  margin: 0;
  padding: 2rem;
  text-align: center;
}
h1 {
  color: #00ffa2;
  letter-spacing: 1px;
}
textarea {
  width: 90%;
  height: 100px;
  margin: 10px 0;
  border-radius: 8px;
  border: none;
  padding: 10px;
  font-size: 16px;
  background: #1b1b1b;
  color: #fff;
}
button {
  background: #00ffa2;
  color: #000;
  border: none;
  padding: 10px 20px;
  margin: 5px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.2s ease;
}
button:hover {
  background: #00cc80;
}
.result {
  margin-top: 15px;
  background: #1b1b1b;
  padding: 15px;
  border-radius: 8px;
  white-space: pre-wrap;
  font-size: 16px;
  min-height: 40px;
}
.footer {
  margin-top: 20px;
  font-size: 13px;
  color: #666;
}
</style>

<!-- 引入 pinyin-pro 拼音库 -->
<script src="https://cdn.jsdelivr.net/npm/pinyin-pro@3.16.0/dist/index.js"></script>

</head>
<body>
<h1>拼音9键暗码工具（改进版）</h1>
<p>输入中文或暗码，点击对应按钮即可转换</p>

<textarea id="inputText" placeholder="输入中文或暗码..."></textarea><br>
<button onclick="encrypt()">中文 → 暗码</button>
<button onclick="decrypt()">暗码 → 拼音</button>
<button onclick="copyResult()">复制结果</button>

<div id="result" class="result"></div>

<div class="footer">© 2025 Jia Liu | 拼音9键暗码系统</div>

<script>
const keypad = {
  '2': 'abc', '3': 'def', '4': 'ghi',
  '5': 'jkl', '6': 'mno', '7': 'pqrs',
  '8': 'tuv', '9': 'wxyz'
};

// 生成反向映射
const reverseMap = {};
for (let key in keypad) {
  [...keypad[key]].forEach((ch, i) => {
    reverseMap[ch] = [key, (i+1).toString()];
  });
}

// 中文转拼音
function toPinyin(chineseText) {
  return pinyinPro.pinyin(chineseText, {toneType: 'none', type: 'string'}).toLowerCase();
}

// 加密：中文 -> 暗码
function encrypt(){
  const text = document.getElementById("inputText").value.trim();
  if (!text) return alert("请输入中文文本！");
  let codes = [];
  for (let ch of text){
    let py = toPinyin(ch);
    if (!py || py === ch) py = '?'; // 容错
    let digits = "", seq = "";
    for (let l of py){
      if (reverseMap[l]){
        digits += reverseMap[l][0];
        seq += reverseMap[l][1];
      }
    }
    codes.push(`${digits}(${seq})`);
  }
  document.getElementById("result").textContent = codes.join(" ");
}

// 解密：暗码 -> 拼音
function decrypt(){
  const text = document.getElementById("inputText").value.trim();
  if (!text) return alert("请输入暗码！");
  const groups = text.split(/\s+/);
  let result = [];
  for (let g of groups){
    const m = g.match(/^(\d+)\((\d+)\)$/);
    if (!m) { result.push('?'); continue; }
    const [_, digits, seq] = m;
    let py = '';
    for (let i=0; i<digits.length; i++){
      const key = digits[i], pos = parseInt(seq[i])-1;
      if (keypad[key] && keypad[key][pos]){
        py += keypad[key][pos];
      } else {
        py += '?';
      }
    }
    result.push(py);
  }
  document.getElementById("result").textContent = result.join(" ");
}

// 复制结果
function copyResult(){
  const result = document.getElementById("result").textContent;
  if (!result) return;
  navigator.clipboard.writeText(result);
  alert("已复制结果！");
}
</script>
</body>
</html>
